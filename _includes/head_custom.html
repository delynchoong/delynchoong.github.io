<link rel="shortcut icon" type="image/x-icon" href="{{ site.baseurl }}/assets/images/favicons/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="{{ site.baseurl }}/assets/images/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="96x96" href="{{ site.baseurl }}/assets/images/favicons/favicon-96x96.png">
<link rel="icon" type="image/svg+xml" href="{{ site.baseurl }}/assets/images/favicons/favicon.svg">

{%- comment -%}
	Custom meta tags for all blog posts.
	NOTE: jekyll-seo-tag already outputs standard SEO/Open Graph/Twitter tags.
	These additions focus on article-specific enrichment (keywords, section, published/modified times, tags list)
	without duplicating existing tags.
{%- endcomment -%}
{%- if page.collection == 'posts' or page.layout == 'single' and page.date -%}
	{%- assign author_name = page.author | default: site.author.name -%}
	{%- if author_name -%}<meta name="author" content="{{ author_name }}">{%- endif -%}
	{%- if page.tags and page.tags.size > 0 -%}
		<meta name="keywords" content="{%- for tag in page.tags -%}{{ tag | strip }}{%- unless forloop.last -%}, {%- endunless -%}{%- endfor -%}">
	{%- endif -%}
	{%- if page.categories and page.categories.size > 0 -%}
		<meta property="article:section" content="{%- for cat in page.categories -%}{{ cat | strip }}{%- unless forloop.last -%}, {%- endunless -%}{%- endfor -%}">
	{%- endif -%}
	{%- if page.date -%}<meta property="article:published_time" content="{{ page.date | date_to_xmlschema }}">{%- endif -%}
	{%- if page.last_modified_at -%}<meta property="article:modified_time" content="{{ page.last_modified_at | date_to_xmlschema }}">{%- endif -%}
	{%- for tag in page.tags -%}
		<meta property="article:tag" content="{{ tag | strip }}">
	{%- endfor -%}
	{%- comment -%}
		Optional: description fallback if none provided (jekyll-seo-tag normally covers this)
	{%- endcomment -%}
	{%- if page.excerpt and page.excerpt != '' and page.excerpt != site.description -%}
		<meta name="description" content="{{ page.excerpt | strip_html | normalize_whitespace | truncate: 155 }}">
	{%- endif -%}
{%- endif -%}

	{%- comment -%}
		Simple per-post view counter and star button using CountAPI (client-only, no auth).
		- Views increment on page load (per path key).
		- Stars increment on click; one star per browser via localStorage guard.
		- Shown only on posts (detected via article:published_time meta above).
	{%- endcomment -%}
	<style>
		#post-engagement { display:flex; gap:12px; align-items:center; margin:.5rem 0 1rem; flex-wrap:wrap; }
		#post-engagement .metric { font-size:.95rem; opacity:.85; }
		#post-engagement button { border:1px solid #ddd; background:#fff; padding:.25rem .55rem; border-radius:6px; cursor:pointer; font-size:.95rem; }
		#post-engagement button.active { background:#ffe89a; border-color:#f0c040; }
		#post-engagement .num { font-variant-numeric: tabular-nums; }
		@media (prefers-color-scheme: dark) {
			#post-engagement button { background:#222; border-color:#444; color:#eee; }
			#post-engagement button.active { background:#5a4a00; border-color:#8a6a00; }
		}
	</style>
	<script>
		document.addEventListener('DOMContentLoaded', function() {
			try {
				var isPost = !!document.querySelector('meta[property="article:published_time"]');
				if (!isPost) return;

				// Namespace based on site.url (fallback to public GitHub Pages URL)
				var nsRaw = '{{ site.url | default: "https://delynchoong.github.io" }}';
				var ns = nsRaw.replace(/^https?:\/\//,'').replace(/\/$/,'').replace(/[^a-zA-Z0-9_.-]/g,'-');
				var path = window.location.pathname.replace(/\/$/, '') || '/';
				var key = encodeURIComponent(path);
				var starKey = key + '-stars';
				var api = 'https://api.countapi.xyz';

				// Build UI container
				var container = document.createElement('div');
				container.id = 'post-engagement';
				container.innerHTML = (
					'<span class="metric" id="view-count">üëÅÔ∏è <span class="num">‚Äî</span></span>' +
					'<button id="star-btn" type="button" aria-label="Star this post">‚≠ê <span class="num">‚Äî</span></button>'
				);

				var target = document.querySelector('.page__meta') || document.querySelector('.page__content') || document.querySelector('article');
				if (target && target.parentNode) target.parentNode.insertBefore(container, target.nextSibling);
				else document.body.appendChild(container);

				function setView(n){ var el = container.querySelector('#view-count .num'); if (el) el.textContent = (n||0).toLocaleString(); }
				function setStars(n){ var el = container.querySelector('#star-btn .num'); if (el) el.textContent = (n||0).toLocaleString(); }

				// Load counts
				fetch(api + '/hit/' + ns + '/' + key)
					.then(function(r){ return r.json(); })
					.then(function(d){ if (d && typeof d.value === 'number') setView(d.value); })
					.catch(function(){ /* ignore */ });

				fetch(api + '/get/' + ns + '/' + starKey)
					.then(function(r){ return r.json(); })
					.then(function(d){ setStars((d && typeof d.value === 'number') ? d.value : 0); })
					.catch(function(){ setStars(0); });

				// Star behavior (one per browser via localStorage)
				var starredKey = 'starred:' + key;
				var starBtn = container.querySelector('#star-btn');
				if (localStorage.getItem(starredKey) === '1') starBtn.classList.add('active');
				starBtn.addEventListener('click', function(){
					if (localStorage.getItem(starredKey) === '1') return;
					fetch(api + '/hit/' + ns + '/' + starKey)
						.then(function(r){ return r.json(); })
						.then(function(d){ setStars(d && typeof d.value === 'number' ? d.value : 0); localStorage.setItem(starredKey, '1'); starBtn.classList.add('active'); })
						.catch(function(){ /* ignore */ });
				});
			} catch(e) { /* noop */ }
		});
	</script>